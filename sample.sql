SELECT D.REF_ID AS REF_ID, D.SOURCE AS SOURCE, D.SOURCE_ID AS SOURCE_ID, D.LAST_ACTION AS LAST_ACTION, D.CURRENT_VERSION AS CURRENT_VERSION, D.AMENDS_LINK_ID AS AMENDS_LINK_ID, D.MSG_FRM_SRC AS MSG_FRM_SRC, D.MSG_FRM_SRC_TIME AS MSG_FRM_SRC_TIME, D.LEG_TYPE AS LEG_TYPE, D.COMPRESS_ENABLED AS COMPRESS_ENABLED, D.COMPRESS_ID AS COMPRESS_ID, D.FIX_TO_BR AS MSG_TO_BRR, D.FIX_TO_BR_DT AS MSG_TO_BRR_TIME, D.TRADE_LEG_FIX_SEQ AS TRADE_LEG_FIX_SEQ, D.TAG17 AS TAG17,  D.FIX_FROM_BR AS MSG_FROM_BRR, D.FIX_BR_DT AS MSG_FROM_BRR_TIME, TANFR.MESSAGE AS MSG_TO_SRC, TANFR.ADD_DATE AS MSG_TO_SRC_TIME, TANFR.TAG17_REP
	(SELECT C.REF_ID AS REF_ID, C.SOURCE AS SOURCE, C.SOURCE_ID AS SOURCE_ID, C.LAST_ACTION AS LAST_ACTION, C.CURRENT_VERSION AS CURRENT_VERSION, C.AMENDS_LINK_ID AS AMENDS_LINK_ID, C.MSG_FRM_SRC AS MSG_FRM_SRC, C.MSG_FRM_SRC_TIME AS MSG_FRM_SRC_TIME, C.LEG_TYPE AS LEG_TYPE, C.COMPRESS_ENABLED AS COMPRESS_ENABLED, C.COMPRESS_ID AS COMPRESS_ID, C.FIX_TO_BR AS MSG_TO_BRR, C.FIX_TO_BR_DT AS MSG_TO_BRR_TIME, C.TRADE_LEG_FIX_SEQ AS TRADE_LEG_FIX_SEQ, C.TAG17 AS TAG17, TANFL.FIX_FROM_BR AS MSG_FROM_BRR, TANFL.FIX_BR_DT AS MSG_FROM_BRR_TIME
		(SELECT B.REF_ID AS REF_ID, B.SOURCE AS SOURCE, B.SOURCE_ID AS SOURCE_ID, B.LAST_ACTION AS LAST_ACTION, B.CURRENT_VERSION AS CURRENT_VERSION, B.AMENDS_LINK_ID AS AMENDS_LINK_ID, B.MSG_FRM_SRC AS MSG_FRM_SRC, B.MSG_FRM_SRC_TIME AS MSG_FRM_SRC_TIME, B.LEG_TYPE AS LEG_TYPE, B.COMPRESS_ENABLED AS COMPRESS_ENABLED, B.COMPRESS_ID AS COMPRESS_ID, TLFL.FIX_TO_BR AS MSG_TO_BRR, TLFL.FIX_TO_BR_DT AS MSG_TO_BRR_DT, TLFL.TRADE_LEG_FIX_SEQ AS TRADE_LEG_FIX_SEQ, TLFL.TAG17 AS TAG17
			(SELECT A.REF_ID AS REF_ID, A.SOURCE AS SOURCE, A.SOURCE_ID AS SOURCE_ID, A.LAST_ACTION AS LAST_ACTION, A.CURRENT_VERSION AS CURRENT_VERSION, A.AMENDS_LINK_ID AS AMENDS_LINK_ID, A.MSG_FRM_SRC AS MSG_FRM_SRC, A.MSG_FRM_SRC_TIME AS MSG_FRM_SRC_TIME, TL.LEG_TYPE AS LEG_TYPE, TL.COMPRESS_ENABLED AS COMPRESS_ENABLED, TL.COMPRESS_ID AS COMPRESS_ID
				(SELECT TB.REF_ID AS REF_ID, TB.SOURCE AS SOURCE, TB.SOURCE_ID AS SOURCE_ID, TB.LAST_ACTION AS LAST_ACTION, TB.CURRENT_VERSION AS CURRENT_VERSION, TB.AMENDS_LINK_ID AS AMENDS_LINK_ID, SJM.MESSAGE AS MSG_FRM_SRC, SJM.LASTUPDATEDTIME AS MSG_FRM_SRC_TIME FROM PTP.TRADE_BASE TB INNER JOIN PTP.STH_JMS_MESSAGE SJM ON TB.JMSMSG_ID=SJM.STH_JMS_INFO_ID) A
					INNER JOIN TRADE_LEG TL ON TL.REF_ID=A.REF_ID) B
					INNER JOIN TRADE_LEG_FIX_LOG TLFL ON TLFL.STH_REF_ID=B.REF_ID) C
					INNER JOIN TRADE_ACK_NACK_FIX_LOG TANFL ON TANFL.TRADE_LEG_FIX_SEQ=C.TRADE_LEG_FIX_SEQ) D
					INNER JOIN TRADE_ACK_NACK_FIX_RESPONSE TANFR ON TANFR.TAG17=D.SOURCE_ID
UNION
SELECT D.REF_ID AS REF_ID, D.SOURCE AS SOURCE, D.SOURCE_ID AS SOURCE_ID, D.LAST_ACTION AS LAST_ACTION, D.PROCESSED_VERSION AS CURRENT_VERSION, D.AMENDS_LINK_ID AS AMENDS_LINK_ID, D.MESSAGE AS MSG_FRM_SRC, D.LASTUPDATEDTIME AS MSG_FRM_SRC_TIME, D.LEG_TYPE AS LEG_TYPE, D.COMPRESS_ENABLED AS COMPRESS_ENABLED, D.COMPRESS_ID AS COMPRESS_ID, D.FIX_TO_BR AS MSG_TO_BRR, D.FIX_TO_BR_DT AS MSG_TO_BRR_DT, D.TRADE_LEG_FIX_SEQ AS TRADE_LEG_FIX_SEQ, D.TAG17 AS TAG17, D.FIX_FROM_BR AS MSG_FROM_BRR, D.FIX_BR_DT AS MSG_FROM_BRR_TIME, TANFR.MESSAGE AS MSG_TO_SRC, TANFR.ADD_DATE AS MSG_TO_SRC_TIME, TANFR.TAG17_REP
	(SELECT C.REF_ID AS REF_ID, C.SOURCE AS SOURCE, C.SOURCE_ID AS SOURCE_ID, C.LAST_ACTION AS LAST_ACTION, C.PROCESSED_VERSION AS CURRENT_VERSION, C.AMENDS_LINK_ID AS AMENDS_LINK_ID, C.MESSAGE AS MSG_FRM_SRC, C.LASTUPDATEDTIME AS MSG_FRM_SRC_TIME, C.LEG_TYPE AS LEG_TYPE, C.COMPRESS_ENABLED AS COMPRESS_ENABLED, C.COMPRESS_ID AS COMPRESS_ID, C.FIX_TO_BR AS MSG_TO_BRR, C.FIX_TO_BR_DT AS MSG_TO_BRR_DT, C.TRADE_LEG_FIX_SEQ AS TRADE_LEG_FIX_SEQ, C.TAG17 AS TAG17, TANFL.FIX_FROM_BR AS MSG_FROM_BRR, TANFL.FIX_BR_DT AS MSG_FROM_BRR_TIME
		(SELECT B.REF_ID AS REF_ID, B.SOURCE AS SOURCE, B.SOURCE_ID AS SOURCE_ID, B.LAST_ACTION AS LAST_ACTION, B.PROCESSED_VERSION AS CURRENT_VERSION, B.AMENDS_LINK_ID AS AMENDS_LINK_ID, B.MESSAGE AS MSG_FRM_SRC, B.LASTUPDATEDTIME AS MSG_FRM_SRC_TIME, B.LEG_TYPE AS LEG_TYPE, B.COMPRESS_ENABLED AS COMPRESS_ENABLED, B.COMPRESS_ID AS COMPRESS_ID, TLFL.FIX_TO_BR AS MSG_TO_BRR, TLFL.FIX_TO_BR_DT AS MSG_TO_BRR_DT, TLFL.TRADE_LEG_FIX_SEQ AS TRADE_LEG_FIX_SEQ, TLFL.TAG17 AS TAG17
			(SELECT A.REF_ID AS REF_ID, A.SOURCE AS SOURCE, A.SOURCE_ID AS SOURCE_ID, A.LAST_ACTION AS LAST_ACTION, A.PROCESSED_VERSION AS CURRENT_VERSION, A.AMENDS_LINK_ID AS AMENDS_LINK_ID, A.MESSAGE AS MSG_FRM_SRC, A.LASTUPDATEDTIME AS MSG_FRM_SRC_TIME, TLH.LEG_TYPE AS LEG_TYPE, TLH.COMPRESS_ENABLED AS COMPRESS_ENABLED, TLH.COMPRESS_ID AS COMPRESS_ID
				(SELECT TBAH.REF_ID AS REF_ID, TBAH.SOURCE AS SOURCE, TBAH.SOURCE_ID AS SOURCE_ID, TBAH.LAST_ACTION AS LAST_ACTION, TBAH.PROCESSED_VERSION AS CURRENT_VERSION, TBAH.AMENDS_LINK_ID AS AMENDS_LINK_ID, SJM.MESSAGE AS MSG_FRM_SRC, SJM.LASTUPDATEDTIME AS MSG_FRM_SRC_TIME FROM PTP.TRADE_BASE_AMD_HISTORY TBAH INNER JOIN PTP.STH_JMS_MESSAGE SJM ON TBAH.JMSMSG_ID=SJM.STH_JMS_INFO_ID) A
					INNER JOIN TRADE_LEG_HISTORY TLH ON TLH.REF_ID=A.REF_ID) B
					INNER JOIN TRADE_LEG_FIX_LOG TLFL ON TLFL.STH_REF_ID=B.REF_ID) C
					INNER JOIN TRADE_ACK_NACK_FIX_LOG TANFL ON TANFL.TRADE_LEG_FIX_SEQ=C.TRADE_LEG_FIX_SEQ) D
					INNER JOIN TRADE_ACK_NACK_FIX_RESPONSE TANFR ON TANFR.TAG17=D.SOURCE_ID;
